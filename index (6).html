<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpastiVidad EM PRO - Evaluaci√≥n y Manejo de la Espasticidad</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }
        .disclaimer.active {
            display: block;
        }
        .disclaimer h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        .disclaimer button {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }
        .disclaimer button:hover {
            background: #e0a800;
        }
        .main-content {
            display: none;
        }
        .main-content.active {
            display: block;
        }
        .nav-tabs {
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .nav-tab {
            flex: 1;
            min-width: 140px;
            padding: 12px 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9em;
        }
        .nav-tab:hover {
            background: #f8f9fa;
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        .content-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .evaluation-grid {
            display: grid;
            gap: 25px;
        }
        .eval-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        .eval-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .slider-container {
            position: relative;
            margin: 20px 0;
        }
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        .slider-value {
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin-top: 10px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
            margin-left: 10px;
        }
        .btn-secondary:hover {
            background: #e9ecef;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .reference {
            background: #e8f5e9;
            border-left: 3px solid #4caf50;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.9em;
            color: #2e7d32;
        }
        .definition-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .definition-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .symptom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .symptom-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .symptom-card h4 {
            color: #667eea;
            margin-bottom: 8px;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
        }
        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            white-space: nowrap;
        }
        .history-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
            position: sticky;
            top: 0;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin-top: 20px;
        }
        .report-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }
        .report-section h3 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .report-metric {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .metric-good {
            background: white;
            border-left-color: #28a745;
            color: #333;
        }
        .metric-warning {
            background: white;
            border-left-color: #ffc107;
            color: #333;
        }
        .metric-danger {
            background: white;
            border-left-color: #dc3545;
            color: #333;
        }
        .metric-info {
            background: white;
            border-left-color: #17a2b8;
            color: #333;
        }
        .print-button {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            margin-right: 10px;
        }
        .print-button:hover {
            background: #218838;
        }
        .exercise-visual {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .exercise-animation {
            flex: 0 0 200px;
            height: 200px;
            background: #f0f4ff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .exercise-description {
            flex: 1;
        }
        .exercise-steps {
            background: #e8f5e9;
            border-left: 3px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .exercise-steps ol {
            margin-left: 20px;
        }
        .exercise-steps li {
            margin: 5px 0;
        }
        .exercise-category {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        .exercise-category h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .exercise-recommendations {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        .exercise-recommendations h3 {
            color: #e65100;
            margin-bottom: 15px;
        }
        .exercise-recommendations ul {
            margin-left: 20px;
        }
        .exercise-recommendations li {
            margin: 8px 0;
            color: #333;
        }
        .movement-arrow {
            stroke: #ff6b6b;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .improvement-indicator {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 5px;
        }
        @media print {
            body {
                background: white;
            }
            .nav-tabs, .btn, .print-button {
                display: none;
            }
        }
        /* Estilos adicionales para prevenir overflow horizontal en m√≥vil */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            .container {
                max-width: 100%;
                overflow-x: hidden;
            }
            .reference {
                font-size: 0.8em;
                padding: 8px 10px;
            }
            .warning-box, .info-box, .success-box {
                padding: 12px;
                font-size: 0.9em;
            }
            /* SVG responsivo espec√≠fico */
            svg {
                max-width: 100%;
                height: auto;
            }
            /* Texto en SVG m√°s peque√±o en m√≥vil */
            svg text {
                font-size: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SpastiVidad EM PRO</h1>
            <p>Sistema Integral de Evaluaci√≥n y Manejo de la Espasticidad en Esclerosis M√∫ltiple</p>
            <p style="font-size: 0.9em; color: #999; margin-top: 10px;">
                Ideada por Jos√© L√≥pez S. del Rosal<br>
                Licenciado en Farmacia y Grado en Fisioterapia
            </p>
        </div>
        <div class="disclaimer active" id="disclaimer">
            <h3>‚ö†Ô∏è Aviso Importante</h3>
            <p>Esta aplicaci√≥n es una herramienta de apoyo exclusivamente para <strong>profesionales m√©dicos</strong> en la evaluaci√≥n y manejo de la espasticidad en Esclerosis M√∫ltiple. No sustituye el juicio cl√≠nico profesional.</p>
            <p><strong>Uso restringido a profesionales sanitarios cualificados.</strong></p>
            <button onclick="acceptDisclaimer()">Entiendo y Acepto</button>
        </div>
        <div class="main-content" id="mainContent">
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showSection('info')">üìö Informaci√≥n</div>
                <div class="nav-tab" onclick="showSection('evaluation')">üìä Evaluaci√≥n de la Espasticidad</div>
                <div class="nav-tab" onclick="showSection('energy')">‚ö° Gasto Energ√©tico Asociado</div>
                <div class="nav-tab" onclick="showSection('quality')">üíù Calidad de Vida</div>
                <div class="nav-tab" onclick="showSection('exercises')">üèÉ Ejercicios</div>
                <div class="nav-tab" onclick="showSection('history')">üìà Evoluci√≥n</div>
                <div class="nav-tab" onclick="showSection('report')">üìÑ Informe</div>
            </div>
            <!-- Secci√≥n de Informaci√≥n sobre Espasticidad -->
            <div class="content-section active" id="info">
                <h2>Espasticidad en la Esclerosis M√∫ltiple</h2>
               
                <div class="definition-card">
                    <h3>¬øQu√© es la Espasticidad?</h3>
                    <p>La espasticidad es un s√≠ntoma com√∫n en la esclerosis m√∫ltiple (EM), caracterizado por un <strong>aumento del tono muscular (hiperton√≠a)</strong> que provoca rigidez y contracciones involuntarias. Se origina por el da√±o en la mielina y las v√≠as nerviosas, alterando la transmisi√≥n de se√±ales entre el cerebro, la m√©dula espinal y los m√∫sculos.<sup>1-5</sup></p>
                    <div class="info-box" style="margin-top: 15px;">
                        <strong>üìä Prevalencia:</strong> Afecta entre el 60% y el 90% de los pacientes con EM en alg√∫n momento de su enfermedad.<sup>2,5,6</sup>
                    </div>
                </div>
                <div class="eval-card">
                    <h3>Especificidades en la EM</h3>
                    <p>En el contexto de la EM, la espasticidad presenta caracter√≠sticas particulares:<sup>1,7</sup></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Origen multifocal:</strong> A diferencia de lesiones medulares aisladas, en la EM el da√±o es generalizado en el SNC<sup>1,7</sup></li>
                        <li><strong>Evoluci√≥n en brotes:</strong> Inicialmente aparece en episodios de m√°s de 24 horas con recuperaci√≥n variable<sup>1</sup></li>
                        <li><strong>Cronificaci√≥n:</strong> Con el tiempo se vuelve permanente, con rigidez continua y espasmos intermitentes<sup>1,8</sup></li>
                        <li><strong>Factores agravantes:</strong> Edad avanzada, sexo masculino y duraci√≥n prolongada de la enfermedad<sup>5</sup></li>
                        <li><strong>Debilidad coexistente:</strong> La rigidez puede compensar parcialmente la p√©rdida de fuerza pero complica movimientos precisos<sup>2,7</sup></li>
                    </ul>
                </div>
                <h3 style="margin-top: 30px; color: #667eea;">S√≠ntomas Asociados</h3>
                <div class="symptom-grid">
                    <div class="symptom-card">
                        <h4>üí™ Musculares<sup>1,2</sup></h4>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Rigidez muscular</li>
                            <li>Espasmos involuntarios</li>
                            <li>Movimientos flexores/extensores</li>
                            <li>Clonus (contracciones repetitivas)</li>
                        </ul>
                    </div>
                   
                    <div class="symptom-card">
                        <h4>üò£ Dolor y Fatiga<sup>2,5,6</sup></h4>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Tensi√≥n muscular</li>
                            <li>Calambres severos</li>
                            <li>Dolor articular</li>
                            <li>Cansancio aumentado</li>
                        </ul>
                    </div>
                   
                    <div class="symptom-card">
                        <h4>üö∂ Alteraciones Motoras<sup>1,3,10</sup></h4>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Dificultad para caminar</li>
                            <li>Posturas anormales</li>
                            <li>Tijereteo de piernas</li>
                            <li>Reducci√≥n del rango de movimiento</li>
                        </ul>
                    </div>
                   
                    <div class="symptom-card">
                        <h4>üè• Otros S√≠ntomas<sup>1,6</sup></h4>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Problemas vesicales/intestinales</li>
                            <li>Trastornos del sue√±o</li>
                            <li>Disfagia y disartria</li>
                            <li>Disfunci√≥n sexual</li>
                        </ul>
                    </div>
                </div>
                <div class="warning-box" style="margin-top: 20px;">
                    <strong>‚ö†Ô∏è Importante:</strong> Los s√≠ntomas son interdependientes. Por ejemplo, el dolor incrementa la espasticidad, creando un ciclo vicioso que debe ser abordado de forma integral.<sup>6</sup>
                </div>
                <!-- Referencias -->
                <div class="reference" style="margin-top: 30px;">
                    <h4>üìö Referencias Bibliogr√°ficas</h4>
                    <ol style="font-size: 0.85em; margin-left: 20px; margin-top: 10px;">
                        <li>Qu√© es la espasticidad: S√≠ntomas, causas y tratamiento. Vivir con EM. Disponible en: vivirconem.com</li>
                        <li>Espasmos musculares en la esclerosis m√∫ltiple. Fundaci√≥n Esclerosis M√∫ltiple. fem.es</li>
                        <li>Espasticidad y esclerosis m√∫ltiple. Sociedad Nacional de EM. nationalmssociety.org</li>
                        <li>La espasticidad y la esclerosis m√∫ltiple: c√≥mo controlar los m√∫sculos. WebMD. webmd.com</li>
                        <li>¬øC√≥mo gestionar la espasticidad en la esclerosis m√∫ltiple? FEM. fem.es</li>
                        <li>Espasticidad un problema m√©dico muy frecuente en pacientes con EM. EM Albacete. emalbacete.es</li>
                        <li>Fisioterapia de la espasticidad: t√©cnicas y m√©todos. Atenci√≥n Primaria. Elsevier. 2004</li>
                        <li>Espasticidad en la esclerosis m√∫ltiple. Neurolog√≠a Almirall. neurologia.almirallmed.es</li>
                        <li>Medici√≥n de la espasticidad. Atenci√≥n Primaria Almirall. atencionprimaria.almirallmed.es</li>
                        <li>Espasticidad. MedlinePlus enciclopedia m√©dica. medlineplus.gov</li>
                        <li>Hobart JC et al. Getting the measure of spasticity in MS: the MS Spasticity Scale (MSSS-88). Neurology. 2006;67(6):1094-1100</li>
                        <li>MacGregor J. The evaluation of patient performance using long-term ambulatory monitoring technique in the management of spasticity. Physiotherapy. 1979;65(2):48-51</li>
                        <li>Granger CV et al. Advances in functional assessment for medical rehabilitation. Arch Phys Med Rehabil. 1979;60(4):145-154</li>
                        <li>Dallmeijer AJ et al. Long-term clinical evaluation of muscle tone in patients with multiple sclerosis. Mult Scler. 2007;13(7):932-940</li>
                        <li>Buysse DJ et al. The Pittsburgh Sleep Quality Index: a new instrument for psychiatric practice and research. Psychiatry Res. 1989;28(2):193-213</li>
                        <li>Brass SD et al. Sleep disorders in patients with multiple sclerosis. Sleep Med. 2010;11(3):235-240</li>
                        <li>Farrar JT et al. Clinical importance of changes in chronic pain intensity measured on an 11-point numerical pain rating scale. Pain. 2001;94(2):149-158</li>
                        <li>Anwar K, Barnes MP. A pilot study of a comparison between a patient scored numeric rating scale and clinician scored measures of spasticity in multiple sclerosis. Clin Rehabil. 2009;23(9):824-834</li>
                        <li>Bohannon RW, Smith MB. Interrater reliability of a modified Ashworth scale of muscle spasticity. Phys Ther. 1987;67(2):206-207</li>
                        <li>Pandyan AD et al. A review of the properties and limitations of the Ashworth and modified Ashworth Scales as measures of spasticity. Age Ageing. 1999;28(1):55-58</li>
                        <li>Penn RD et al. Intrathecal baclofen for severe spinal spasticity. Neurosurgery. 1989;25(2):196-201</li>
                        <li>Priebe MM et al. Clinical assessment of spasticity in spinal cord injury: a multidimensional problem. Arch Phys Med Rehabil. 1996;77(12):1224-1230</li>
                        <li>Podsiadlo D, Richardson S. The timed "Up & Go": a test of basic functional mobility for frail elderly persons. J Am Geriatr Soc. 1991;39(2):142-148</li>
                        <li>Sebasti√£o E et al. Validity of the Timed Up and Go Test as a measure of functional mobility in persons with multiple sclerosis. Arch Phys Med Rehabil. 2016;97(7):1154-1160</li>
                        <li>Welk B et al. The Neurogenic Bladder Symptom Score (NBSS): a secondary assessment of its validity, reliability among people with a spinal cord injury. J Urol. 2013;189(5):1709-1715</li>
                        <li>Cintra LKL et al. Cross-cultural adaptation and validation of the Neurogenic Bladder Symptom Score to Brazilian Portuguese. Mult Scler Relat Disord. 2020;46:102469</li>
                        <li>Fowler CJ et al. A UK consensus on the management of the bladder in multiple sclerosis. J Neurol Neurosurg Psychiatry. 2009;80(5):470-477</li>
                    </ol>
                </div>
            </div>
            <!-- Secci√≥n de Evaluaci√≥n -->
            <div class="content-section" id="evaluation">
                <h2>Evaluaci√≥n de la Espasticidad</h2>
               
                <div class="evaluation-grid">
                    <!-- NRS de Espasticidad -->
                    <div class="eval-card">
                        <h3>Escala Num√©rica NRS de Espasticidad</h3>
                        <div class="reference">
                            üìö Farrar JT et al. Pain. 2001;94(2):149-158
                            <br>Validado en EM: Anwar K, Barnes MP. Clin Rehabil. 2009;23(9):824-834
                        </div>
                        <p>Eval√∫e el impacto de la espasticidad percibido por el paciente en las √∫ltimas 24 horas:</p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="nrsScore" oninput="updateNRS()">
                            <div class="slider-value" id="nrsValue">5</div>
                        </div>
                        <p style="text-align: center; margin-top: 10px;">
                            <span style="float: left;">0 = Sin espasticidad</span>
                            <span style="float: right;">10 = M√°xima espasticidad</span>
                        </p>
                        <div class="info-box" style="margin-top: 40px;">
                            ‚ÑπÔ∏è Una reducci√≥n ‚â•30% se considera cl√≠nicamente relevante
                        </div>
                    </div>
                    <!-- Escala de Ashworth Modificada -->
                    <div class="eval-card">
                        <h3>Escala de Ashworth Modificada</h3>
                        <div class="reference">
                            üìö Bohannon RW, Smith MB. Phys Ther. 1987;67(2):206-207
                            <br>Validaci√≥n: Pandyan AD et al. Age Ageing. 1999;28(1):55-58
                        </div>
                        <div class="form-group">
                            <label>Seleccione el grado de espasticidad:</label>
                            <select id="ashworth">
                                <option value="0">0 - Sin aumento del tono muscular</option>
                                <option value="1">1 - Ligero aumento del tono con resistencia m√≠nima al final del ROM</option>
                                <option value="1+">1+ - Ligero aumento del tono con resistencia en menos de la mitad del ROM</option>
                                <option value="2">2 - Aumento marcado del tono durante la mayor parte del ROM</option>
                                <option value="3">3 - Aumento considerable del tono, movimiento pasivo dif√≠cil</option>
                                <option value="4">4 - Parte afectada r√≠gida en flexi√≥n o extensi√≥n</option>
                            </select>
                        </div>
                    </div>
                    <!-- Registro de Espasmos -->
                    <div class="eval-card">
                        <h3>Registro de Espasmos - Penn Spasm Frequency Scale</h3>
                        <div class="reference">
                            üìö Penn RD et al. Neurosurgery. 1989;25(2):196-201
                            <br>Adaptado para EM: Priebe MM et al. Arch Phys Med Rehabil. 1996;77(12):1224-1230
                        </div>
                        <div class="form-group">
                            <label>Frecuencia de espasmos (√∫ltimas 24 horas):</label>
                            <select id="spasmsFreq" onchange="updateSpasmsTotal()">
                                <option value="0">Sin espasmos</option>
                                <option value="1">Espasmos leves (1-5 al d√≠a)</option>
                                <option value="2">Espasmos moderados (6-10 al d√≠a)</option>
                                <option value="3">Espasmos frecuentes (>10 al d√≠a)</option>
                                <option value="4">Espasmos continuos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Intensidad de los espasmos:</label>
                            <select id="spasmsIntensity" onchange="updateSpasmsTotal()">
                                <option value="0">Sin espasmos</option>
                                <option value="1">Leve</option>
                                <option value="2">Moderada</option>
                                <option value="3">Severa</option>
                            </select>
                        </div>
                        <div class="info-box">
                            <strong>Puntuaci√≥n total de espasmos: <span id="spasmsTotal">0</span> / 7</strong>
                        </div>
                    </div>
                    <!-- Test Timed Up and Go -->
                    <div class="eval-card">
                        <h3>Test Timed Up and Go (TUG)</h3>
                        <div class="reference">
                            üìö Podsiadlo D, Richardson S. J Am Geriatr Soc. 1991;39(2):142-148
                            <br>Validado en EM: Sebasti√£o E et al. Arch Phys Med Rehabil. 2016;97(7):1154-1160
                        </div>
                        <p>Tiempo en segundos para levantarse de una silla, caminar 3 metros, girar, volver y sentarse:</p>
                        <div class="form-group">
                            <label>Tiempo (segundos):</label>
                            <input type="number" id="tugTime" placeholder="Ej: 12.5" step="0.1">
                        </div>
                        <div class="info-box">
                            <strong>Valores de referencia:</strong><br>
                            ‚Ä¢ &lt;10 seg: Normal<br>
                            ‚Ä¢ 10-20 seg: Riesgo bajo de ca√≠das<br>
                            ‚Ä¢ 20-30 seg: Riesgo moderado<br>
                            ‚Ä¢ &gt;30 seg: Riesgo alto
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveEvaluation(this)">üíæ Guardar Evaluaci√≥n</button>
                    <button class="btn btn-secondary" onclick="returnToMenu()">üè† Volver al Men√∫</button>
                </div>
            </div>
            <!-- Secci√≥n de Gasto Energ√©tico -->
            <div class="content-section" id="energy">
                <h2>Evaluaci√≥n del Gasto Energ√©tico</h2>
               
                <div class="eval-card">
                    <h3>√çndice de Coste Fisiol√≥gico (PCI)</h3>
                    <div class="reference">
                        üìö MacGregor J. Physiotherapy. 1979;65(2):48-51
                    </div>
                   
                    <div class="info-box">
                        <strong>¬øC√≥mo se realiza?</strong><br>
                        1. Medir FC en reposo (sentado 5 minutos)<br>
                        2. Realizar el test TUG<br>
                        3. Medir FC inmediatamente al finalizar<br>
                        4. Calcular: PCI = (FC final - FC reposo) / velocidad de marcha
                    </div>
                    <div class="form-group">
                        <label>Frecuencia Card√≠aca en Reposo (lpm):</label>
                        <input type="number" id="hrRest" placeholder="Ej: 70">
                    </div>
                    <div class="form-group">
                        <label>Frecuencia Card√≠aca Post-TUG (lpm):</label>
                        <input type="number" id="hrPost" placeholder="Ej: 95">
                    </div>
                    <div class="form-group">
                        <label>Distancia recorrida (metros):</label>
                        <input type="number" id="distance" value="6" placeholder="Est√°ndar: 6m">
                    </div>
                    <button class="btn btn-primary" onclick="calculatePCI()">üìä Calcular PCI</button>
                    <div id="pciResult" style="margin-top: 20px; display: none;">
                        <div class="eval-card" style="background: #e8f5e9;">
                            <h4>Resultado del PCI</h4>
                            <p id="pciValue" style="font-size: 1.5em; color: #2e7d32; font-weight: bold;"></p>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-success" onclick="saveEnergyEvaluation(this)">üíæ Guardar Evaluaci√≥n</button>
                    <button class="btn btn-secondary" onclick="returnToMenu()">üè† Volver al Men√∫</button>
                </div>
            </div>
            <!-- Secci√≥n de Calidad de Vida -->
            <div class="content-section" id="quality">
                <h2>Evaluaci√≥n de Calidad de Vida</h2>
                <div class="evaluation-grid">
                    <!-- NRS de Impacto Percibido -->
                    <div class="eval-card">
                        <h3>NRS - Impacto de la Espasticidad Percibido por el Paciente</h3>
                        <div class="reference">
                            üìö Hobart JC et al. Neurology. 2006;67(6):1094-1100
                        </div>
                        <p>¬øCu√°nto afecta la espasticidad a su vida diaria?</p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="impactScore" oninput="updateImpact()">
                            <div class="slider-value" id="impactValue">5</div>
                        </div>
                        <p style="text-align: center; margin-top: 10px;">
                            <span style="float: left;">0 = Sin impacto</span>
                            <span style="float: right;">10 = M√°ximo impacto</span>
                        </p>
                        <div class="info-box" style="margin-top: 40px;">
                            ‚ÑπÔ∏è Esta puntuaci√≥n complementa la NRS de espasticidad evaluada anteriormente
                        </div>
                    </div>
                    <!-- Actividades de la Vida Diaria -->
                    <div class="eval-card">
                        <h3>Actividades de la Vida Diaria - √çndice de Barthel Modificado para EM</h3>
                        <div class="reference">
                            üìö Granger CV et al. Arch Phys Med Rehabil. 1979;60(4):145-154
                            <br>Validado en EM: Dallmeijer AJ et al. Mult Scler. 2007;13(7):932-940
                        </div>
                       
                        <div class="form-group">
                            <label>Movilidad/Deambulaci√≥n:</label>
                            <select id="avdMobility" onchange="calculateAVDScore()">
                                <option value="0">Independiente (>50m)</option>
                                <option value="5">Con ayuda t√©cnica</option>
                                <option value="10">Con supervisi√≥n</option>
                                <option value="15">Con ayuda de una persona</option>
                                <option value="20">Silla de ruedas independiente</option>
                                <option value="25">Dependiente total</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Transferencias:</label>
                            <select id="avdTransfers" onchange="calculateAVDScore()">
                                <option value="0">Independiente</option>
                                <option value="5">M√≠nima ayuda</option>
                                <option value="10">Ayuda moderada</option>
                                <option value="15">Dependiente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Aseo personal:</label>
                            <select id="avdToilet" onchange="calculateAVDScore()">
                                <option value="0">Independiente</option>
                                <option value="5">Con ayuda</option>
                                <option value="10">Dependiente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vestido:</label>
                            <select id="avdDressing" onchange="calculateAVDScore()">
                                <option value="0">Independiente</option>
                                <option value="5">Con ayuda</option>
                                <option value="10">Dependiente</option>
                            </select>
                        </div>
                        <div class="info-box" style="background: #e8f5e9; border-left-color: #4caf50;">
                            <strong>Puntuaci√≥n AVD Total: <span id="avdTotal">0</span> / 60</strong>
                            <br>Interpretaci√≥n:
                            <br>‚Ä¢ 0-15: Independencia funcional
                            <br>‚Ä¢ 16-35: Dependencia leve-moderada
                            <br>‚Ä¢ 36-60: Dependencia severa
                        </div>
                    </div>
                    <!-- Escala de S√≠ntomas Vesicales Neur√≥genos NBSS -->
                    <div class="eval-card">
                        <h3>Escala NBSS (Neurogenic Bladder Symptom Score)</h3>
                        <div class="reference">
                            üìö Welk B et al. J Urol. 2013;189(5):1709-1715<br>
                            Validado en EM: Cintra LKL et al. Mult Scler Relat Disord. 2020;46:102469
                        </div>
                       
                        <div class="form-group">
                            <label>Frecuencia miccional diurna:</label>
                            <select id="bladderFrequency" onchange="calculateBladderScore()">
                                <option value="0">Normal (4-7 veces/d√≠a)</option>
                                <option value="1">8-10 veces/d√≠a</option>
                                <option value="2">11-15 veces/d√≠a</option>
                                <option value="3">M√°s de 15 veces/d√≠a</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Urgencia miccional/espasmos del detrusor:</label>
                            <select id="bladderUrgency" onchange="calculateBladderScore()">
                                <option value="0">Nunca</option>
                                <option value="1">Ocasionalmente</option>
                                <option value="2">Frecuentemente</option>
                                <option value="3">Siempre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Episodios de incontinencia de urgencia:</label>
                            <select id="bladderIncontinence" onchange="calculateBladderScore()">
                                <option value="0">Nunca</option>
                                <option value="1">1 vez/semana o menos</option>
                                <option value="2">2-3 veces/semana</option>
                                <option value="3">Diariamente</option>
                                <option value="4">Varias veces al d√≠a</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nicturia (levantarse por la noche para orinar):</label>
                            <select id="bladderNocturia" onchange="calculateBladderScore()">
                                <option value="0">0-1 vez</option>
                                <option value="1">2 veces</option>
                                <option value="2">3 veces</option>
                                <option value="3">4 o m√°s veces</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dificultad para vaciar vejiga:</label>
                            <select id="bladderEmptying" onchange="calculateBladderScore()">
                                <option value="0">Nunca</option>
                                <option value="1">Ocasionalmente</option>
                                <option value="2">Frecuentemente</option>
                                <option value="3">Siempre/usa sonda</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Uso de protecci√≥n (pa√±ales, compresas):</label>
                            <select id="bladderProtection" onchange="calculateBladderScore()">
                                <option value="0">Nunca</option>
                                <option value="1">Por precauci√≥n</option>
                                <option value="2">1-2 al d√≠a</option>
                                <option value="3">3-4 al d√≠a</option>
                                <option value="4">5 o m√°s al d√≠a</option>
                            </select>
                        </div>
                        <div class="info-box" style="background: #fff3e0; border-left-color: #ff9800;">
                            <strong>Puntuaci√≥n NBSS Total: <span id="bladderTotal">0</span> / 20</strong>
                            <br>Interpretaci√≥n:
                            <br>‚Ä¢ 0-5: S√≠ntomas leves
                            <br>‚Ä¢ 6-10: S√≠ntomas moderados (considerar tratamiento)
                            <br>‚Ä¢ 11-15: S√≠ntomas severos (requiere evaluaci√≥n urol√≥gica)
                            <br>‚Ä¢ >15: S√≠ntomas muy severos (evaluaci√≥n urgente)
                        </div>
                    </div>
                    <!-- Escala de Calidad del Sue√±o -->
                    <div class="eval-card">
                        <h3>Calidad del Sue√±o (PSQI simplificado para EM)</h3>
                        <div class="reference">
                            üìö Buysse DJ et al. Psychiatry Res. 1989;28(2):193-213<br>
                            Validado en EM: Brass SD et al. Sleep Med. 2010;11(3):235-240
                        </div>
                       
                        <div class="form-group">
                            <label>¬øC√≥mo calificar√≠a su calidad de sue√±o en general?</label>
                            <select id="sleepQuality" onchange="calculateSleepScore()">
                                <option value="0">Muy buena</option>
                                <option value="1">Bastante buena</option>
                                <option value="2">Bastante mala</option>
                                <option value="3">Muy mala</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>¬øCu√°ntas veces se despert√≥ por espasmos/dolor en la √∫ltima semana?</label>
                            <select id="sleepDisturbance" onchange="calculateSleepScore()">
                                <option value="0">Ninguna</option>
                                <option value="1">Menos de 1 vez/semana</option>
                                <option value="2">1-2 veces/semana</option>
                                <option value="3">3 o m√°s veces/semana</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tiempo para conciliar el sue√±o (minutos):</label>
                            <select id="sleepLatency" onchange="calculateSleepScore()">
                                <option value="0">‚â§15 minutos</option>
                                <option value="1">16-30 minutos</option>
                                <option value="2">31-60 minutos</option>
                                <option value="3">>60 minutos</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Horas de sue√±o efectivo por noche:</label>
                            <input type="number" id="sleepHours" placeholder="Ej: 6.5" step="0.5" min="0" max="24" onchange="calculateSleepScore()">
                        </div>
                        <div class="info-box" style="background: #e3f2fd; border-left-color: #2196f3;">
                            <strong>Puntuaci√≥n PSQI: <span id="sleepTotal">0</span> / 12</strong>
                            <br>Interpretaci√≥n:
                            <br>‚Ä¢ 0-4: Buena calidad del sue√±o
                            <br>‚Ä¢ 5-8: Calidad del sue√±o moderada
                            <br>‚Ä¢ >8: Mala calidad del sue√±o
                        </div>
                    </div>
                    <!-- Escala de Dolor -->
                    <div class="eval-card">
                        <h3>Escala Visual Anal√≥gica (EVA) de Dolor</h3>
                        <p>Intensidad del dolor relacionado con la espasticidad:</p>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="painScore" oninput="updatePain()">
                            <div class="slider-value" id="painValue">5</div>
                        </div>
                        <p style="text-align: center; margin-top: 10px;">
                            <span style="float: left;">0 = Sin dolor</span>
                            <span style="float: right;">10 = M√°ximo dolor</span>
                        </p>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveQualityOfLife(this)">üíæ Guardar Evaluaci√≥n</button>
                    <button class="btn btn-secondary" onclick="returnToMenu()">üè† Volver al Men√∫</button>
                </div>
            </div>
            <!-- Secci√≥n de Ejercicios Mejorada -->
            <div class="content-section" id="exercises">
                <h2>Gu√≠a Visual de Ejercicios para Espasticidad en EM</h2>
                <div class="reference">
                    üìö Gu√≠a de ejercicios Almirall - Esclerosis M√∫ltiple Espa√±a (EME)
                </div>
                
                <!-- Recomendaciones personalizadas -->
                <div id="exerciseRecommendations" class="exercise-recommendations" style="display:none;">
                    <h3>üéØ Recomendaciones Personalizadas Seg√∫n Su Evaluaci√≥n</h3>
                    <ul id="exerciseRecommendationsList">
                    </ul>
                </div>
                
                <!-- Recomendaciones Generales -->
                <div class="exercise-category">
                    <h3>üìå Recomendaciones Generales</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb);">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <defs>
                                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#ff6b6b"/>
                                    </marker>
                                </defs>
                                <!-- Representaci√≥n de aplicaci√≥n de fr√≠o -->
                                <rect x="50" y="50" width="80" height="80" rx="10" fill="#2196f3" opacity="0.3"/>
                                <circle cx="70" cy="70" r="5" fill="#fff" opacity="0.8">
                                    <animate attributeName="cy" values="70;110;70" dur="3s" repeatCount="indefinite"/>
                                </circle>
                                <circle cx="90" cy="90" r="4" fill="#fff" opacity="0.7">
                                    <animate attributeName="cy" values="90;110;90" dur="2.5s" repeatCount="indefinite"/>
                                </circle>
                                <circle cx="110" cy="80" r="6" fill="#fff" opacity="0.9">
                                    <animate attributeName="cy" values="80;110;80" dur="3.5s" repeatCount="indefinite"/>
                                </circle>
                                <text x="90" y="160" text-anchor="middle" font-size="14" fill="#333">Crioterapia</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Crioterapia Local</h4>
                            <p>Aplicaci√≥n de fr√≠o para reducir temporalmente el tono muscular</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Aplicar bolsa de hielo envuelta en toalla</li>
                                    <li>Mantener 15-20 minutos sobre el m√∫sculo esp√°stico</li>
                                    <li>Permite 20-30 minutos de mejor√≠a para realizar estiramientos</li>
                                    <li>Evitar aplicaci√≥n directa sobre la piel</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ejercicios de Cuello -->
                <div class="exercise-category">
                    <h3>ü¶¥ Ejercicios de Cuello</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Cabeza y cuello simplificados -->
                                <ellipse cx="90" cy="60" rx="35" ry="40" fill="#667eea" opacity="0.3"/>
                                <rect x="75" y="80" width="30" height="40" fill="#667eea" opacity="0.3"/>
                                <!-- Flecha de rotaci√≥n -->
                                <path d="M 50 60 Q 90 30, 130 60" class="movement-arrow" stroke-dasharray="5,5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 60;30 90 60;0 90 60;-30 90 60;0 90 60"
                                        dur="4s" repeatCount="indefinite"/>
                                </path>
                                <text x="90" y="160" text-anchor="middle" font-size="12" fill="#333">Rotaci√≥n lateral</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Rotaci√≥n de Cuello</h4>
                            <p>Estiramiento suave para reducir la tensi√≥n cervical</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Girar lentamente la cabeza hacia un lado</li>
                                    <li>Mantener 30 segundos sin dolor</li>
                                    <li>Volver al centro lentamente</li>
                                    <li>Repetir hacia el otro lado</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Cabeza inclin√°ndose -->
                                <ellipse cx="90" cy="60" rx="35" ry="40" fill="#667eea" opacity="0.3">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 100;-20 90 100;0 90 100;20 90 100;0 90 100"
                                        dur="4s" repeatCount="indefinite"/>
                                </ellipse>
                                <rect x="75" y="80" width="30" height="40" fill="#667eea" opacity="0.3"/>
                                <text x="90" y="160" text-anchor="middle" font-size="12" fill="#333">Flexi√≥n lateral</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Flexi√≥n Lateral</h4>
                            <p>Estiramiento de los m√∫sculos laterales del cuello</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Inclinar la cabeza llevando oreja hacia hombro</li>
                                    <li>Mantener el hombro contrario relajado y bajo</li>
                                    <li>Sostener 30 segundos</li>
                                    <li>Realizar 3 repeticiones por lado</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ejercicios de Tronco -->
                <div class="exercise-category">
                    <h3>üßò Ejercicios de Tronco</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Tronco y rotaci√≥n -->
                                <rect x="70" y="40" width="40" height="60" fill="#667eea" opacity="0.3">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 70;-20 90 70;0 90 70;20 90 70;0 90 70"
                                        dur="4s" repeatCount="indefinite"/>
                                </rect>
                                <!-- Piernas -->
                                <rect x="75" y="100" width="15" height="40" fill="#667eea" opacity="0.3"/>
                                <rect x="90" y="100" width="15" height="40" fill="#667eea" opacity="0.3"/>
                                <text x="90" y="160" text-anchor="middle" font-size="12" fill="#333">Rotaci√≥n de tronco</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Rotaci√≥n de Tronco</h4>
                            <p>Mejora la flexibilidad de la columna</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Sentado con piernas cruzadas</li>
                                    <li>Girar el tronco hacia un lado</li>
                                    <li>Apoyar la mano contraria en la rodilla</li>
                                    <li>Mantener 30 segundos y cambiar</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Estiramiento gato-vaca -->
                                <path d="M 30 90 Q 90 60, 150 90" fill="none" stroke="#667eea" stroke-width="6" opacity="0.5">
                                    <animate attributeName="d"
                                        values="M 30 90 Q 90 60, 150 90;M 30 90 Q 90 120, 150 90;M 30 90 Q 90 60, 150 90"
                                        dur="3s" repeatCount="indefinite"/>
                                </path>
                                <circle cx="30" cy="90" r="8" fill="#667eea" opacity="0.5"/>
                                <circle cx="150" cy="90" r="8" fill="#667eea" opacity="0.5"/>
                                <text x="90" y="160" text-anchor="middle" font-size="12" fill="#333">Estiramiento gato-vaca</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Movilizaci√≥n Espinal</h4>
                            <p>Flexibilizaci√≥n de toda la columna</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>En cuadrupedia (4 patas)</li>
                                    <li>Arquear la espalda hacia arriba (gato)</li>
                                    <li>Luego hundir la espalda (vaca)</li>
                                    <li>Movimientos lentos y controlados</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ejercicios de Piernas -->
                <div class="exercise-category">
                    <h3>ü¶µ Ejercicios de Piernas</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Pierna flexion√°ndose -->
                                <line x1="90" y1="40" x2="90" y2="90" stroke="#667eea" stroke-width="8" opacity="0.5"/>
                                <line x1="90" y1="90" x2="90" y2="140" stroke="#667eea" stroke-width="8" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 90;-60 90 90;0 90 90"
                                        dur="3s" repeatCount="indefinite"/>
                                </line>
                                <!-- Flecha indicando movimiento -->
                                <path d="M 120 120 Q 110 100, 90 90" class="movement-arrow"/>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Flexi√≥n de rodilla</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Flexi√≥n de Rodilla</h4>
                            <p>Estiramiento de isquiotibiales</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Tumbado boca arriba, flexionar una rodilla</li>
                                    <li>Llevar la rodilla hacia el pecho suavemente</li>
                                    <li>Mantener 30 segundos</li>
                                    <li>La otra pierna permanece estirada</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Representaci√≥n de estiramiento de gemelos -->
                                <line x1="60" y1="120" x2="90" y2="90" stroke="#667eea" stroke-width="8" opacity="0.5"/>
                                <line x1="90" y1="90" x2="120" y2="120" stroke="#667eea" stroke-width="8" opacity="0.5"/>
                                <!-- Pie flexion√°ndose -->
                                <rect x="50" y="115" width="20" height="10" fill="#667eea" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 60 120;-20 60 120;0 60 120"
                                        dur="2s" repeatCount="indefinite"/>
                                </rect>
                                <rect x="110" y="115" width="20" height="10" fill="#667eea" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 120 120;-20 120 120;0 120 120"
                                        dur="2s" repeatCount="indefinite"/>
                                </rect>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Estiramiento gemelos</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Estiramiento de Gemelos</h4>
                            <p>Reducci√≥n de la espasticidad en pantorrillas</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>De pie frente a una pared</li>
                                    <li>Pierna adelantada flexionada, trasera estirada</li>
                                    <li>Tal√≥n trasero en contacto con el suelo</li>
                                    <li>Mantener 30 segundos por pierna</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Estiramiento de aductores -->
                                <line x1="90" y1="60" x2="60" y2="120" stroke="#667eea" stroke-width="8" opacity="0.5">
                                    <animate attributeName="x2" values="60;40;60" dur="3s" repeatCount="indefinite"/>
                                </line>
                                <line x1="90" y1="60" x2="120" y2="120" stroke="#667eea" stroke-width="8" opacity="0.5">
                                    <animate attributeName="x2" values="120;140;120" dur="3s" repeatCount="indefinite"/>
                                </line>
                                <circle cx="90" cy="60" r="10" fill="#667eea" opacity="0.5"/>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Estiramiento aductores</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Estiramiento de Aductores</h4>
                            <p>Apertura de caderas y muslos internos</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Sentado, juntar plantas de los pies</li>
                                    <li>Dejar caer rodillas hacia los lados</li>
                                    <li>Inclinar tronco hacia adelante suavemente</li>
                                    <li>Mantener 30 segundos</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Estiramiento de cu√°driceps -->
                                <line x1="90" y1="60" x2="90" y2="110" stroke="#667eea" stroke-width="8" opacity="0.5"/>
                                <line x1="90" y1="110" x2="90" y2="140" stroke="#667eea" stroke-width="8" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 110;90 90 110;0 90 110"
                                        dur="3s" repeatCount="indefinite"/>
                                </line>
                                <circle cx="90" cy="140" r="6" fill="#667eea" opacity="0.7">
                                    <animateTransform attributeName="transform" type="translate"
                                        values="0,0;-20,-30;0,0"
                                        dur="3s" repeatCount="indefinite"/>
                                </circle>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Estiramiento cu√°driceps</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Estiramiento de Cu√°driceps</h4>
                            <p>Parte anterior del muslo</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>De pie o tumbado de lado</li>
                                    <li>Flexionar rodilla llevando tal√≥n a gl√∫teo</li>
                                    <li>Sujetar tobillo con la mano</li>
                                    <li>Mantener rodilla alineada con cadera</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ejercicios de Brazos -->
                <div class="exercise-category">
                    <h3>üí™ Ejercicios de Brazos</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Brazo estir√°ndose -->
                                <line x1="60" y1="90" x2="90" y2="90" stroke="#667eea" stroke-width="6" opacity="0.5"/>
                                <line x1="90" y1="90" x2="120" y2="90" stroke="#667eea" stroke-width="6" opacity="0.5">
                                    <animate attributeName="x2" values="120;140;120" dur="2s" repeatCount="indefinite"/>
                                </line>
                                <!-- Mano -->
                                <circle cx="120" cy="90" r="8" fill="#667eea" opacity="0.5">
                                    <animate attributeName="cx" values="120;140;120" dur="2s" repeatCount="indefinite"/>
                                </circle>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Estiramiento tr√≠ceps</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Estiramiento de Tr√≠ceps</h4>
                            <p>Parte posterior del brazo</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Elevar brazo por encima de la cabeza</li>
                                    <li>Flexionar codo llevando mano hacia espalda</li>
                                    <li>Con otra mano empujar suavemente el codo</li>
                                    <li>Mantener 30 segundos cada brazo</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Estiramiento de mu√±eca -->
                                <line x1="60" y1="90" x2="120" y2="90" stroke="#667eea" stroke-width="6" opacity="0.5"/>
                                <!-- Mano flexion√°ndose -->
                                <rect x="115" y="85" width="30" height="10" fill="#667eea" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 120 90;-45 120 90;45 120 90;0 120 90"
                                        dur="3s" repeatCount="indefinite"/>
                                </rect>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Movilizaci√≥n mu√±eca</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Movilizaci√≥n de Mu√±eca</h4>
                            <p>Flexibilidad de mu√±eca y antebrazo</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Extender brazo hacia adelante</li>
                                    <li>Flexionar mu√±eca hacia arriba y abajo</li>
                                    <li>Realizar c√≠rculos lentos</li>
                                    <li>10 repeticiones en cada direcci√≥n</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Transferencias y Movilidad -->
                <div class="exercise-category">
                    <h3>üîÑ Transferencias Seguras</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Representaci√≥n de sentado a de pie -->
                                <rect x="60" y="100" width="60" height="10" fill="#999" opacity="0.3"/>
                                <!-- Persona -->
                                <ellipse cx="90" cy="60" rx="15" ry="20" fill="#667eea" opacity="0.5">
                                    <animate attributeName="cy" values="80;60;80" dur="3s" repeatCount="indefinite"/>
                                </ellipse>
                                <rect x="85" y="70" width="10" height="30" fill="#667eea" opacity="0.5">
                                    <animate attributeName="height" values="20;30;20" dur="3s" repeatCount="indefinite"/>
                                    <animate attributeName="y" values="80;70;80" dur="3s" repeatCount="indefinite"/>
                                </rect>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Sentado a de pie</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>De Sentado a De Pie</h4>
                            <p>Transferencia b√°sica segura</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Pies apoyados firmemente, separados ancho de caderas</li>
                                    <li>Inclinar tronco hacia adelante</li>
                                    <li>Impulsar desde gl√∫teos y piernas</li>
                                    <li>Evitar tirar de objetos para levantarse</li>
                                </ol>
                            </div>
                            <div class="reference" style="margin-top: 10px;">
                                üìñ Ver p√°ginas 15-22 del PDF Almirall para t√©cnicas detalladas con ilustraciones
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Giro en cama -->
                                <rect x="40" y="80" width="100" height="20" fill="#999" opacity="0.2"/>
                                <ellipse cx="90" cy="90" rx="40" ry="15" fill="#667eea" opacity="0.5">
                                    <animateTransform attributeName="transform" type="rotate"
                                        values="0 90 90;90 90 90;0 90 90"
                                        dur="4s" repeatCount="indefinite"/>
                                </ellipse>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Giro en cama</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Giro en la Cama</h4>
                            <p>Cambio de posici√≥n lateral</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Flexionar las rodillas</li>
                                    <li>Girar primero pelvis y piernas</li>
                                    <li>Luego girar tronco y hombros</li>
                                    <li>No girar "en bloque"</li>
                                </ol>
                            </div>
                            <div class="reference" style="margin-top: 10px;">
                                üìñ T√©cnica detallada en p√°ginas 16-17 del PDF Almirall
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Transferencia a silla de ruedas -->
                                <circle cx="50" cy="110" r="15" fill="#999" opacity="0.3"/>
                                <circle cx="130" cy="110" r="15" fill="#999" opacity="0.3"/>
                                <rect x="40" y="80" width="20" height="30" fill="#999" opacity="0.3"/>
                                <rect x="120" y="80" width="20" height="30" fill="#999" opacity="0.3"/>
                                <!-- Persona movi√©ndose -->
                                <ellipse cx="50" cy="60" rx="15" ry="20" fill="#667eea" opacity="0.5">
                                    <animate attributeName="cx" values="50;90;130" dur="3s" repeatCount="indefinite"/>
                                </ellipse>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Transferencia lateral</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Transferencia a Silla de Ruedas</h4>
                            <p>Paso seguro entre superficies</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Colocar silla en √°ngulo de 45-90¬∞</li>
                                    <li>Frenar la silla y retirar reposapies</li>
                                    <li>Deslizar hacia el borde del asiento</li>
                                    <li>Pivotar sobre los pies, no sobre espalda</li>
                                </ol>
                            </div>
                            <div class="reference" style="margin-top: 10px;">
                                üìñ Ver p√°ginas 20-22 del PDF Almirall para transferencias con ayuda
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ejercicios Respiratorios -->
                <div class="exercise-category">
                    <h3>ü´Å Ejercicios Respiratorios</h3>
                   
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Representaci√≥n del torso y abdomen -->
                                <ellipse cx="90" cy="90" rx="50" ry="60" fill="#667eea" opacity="0.2">
                                    <animate attributeName="rx" values="50;60;50" dur="4s" repeatCount="indefinite"/>
                                    <animate attributeName="ry" values="60;70;60" dur="4s" repeatCount="indefinite"/>
                                </ellipse>
                                <!-- Flechas de expansi√≥n -->
                                <path d="M 40 90 L 20 90" stroke="#ff6b6b" stroke-width="2" opacity="0.6">
                                    <animate attributeName="d" values="M 40 90 L 20 90;M 30 90 L 10 90;M 40 90 L 20 90" dur="4s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 140 90 L 160 90" stroke="#ff6b6b" stroke-width="2" opacity="0.6">
                                    <animate attributeName="d" values="M 140 90 L 160 90;M 150 90 L 170 90;M 140 90 L 160 90" dur="4s" repeatCount="indefinite"/>
                                </path>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Respiraci√≥n abdominal</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Respiraci√≥n Diafragm√°tica</h4>
                            <p>Reducci√≥n del estr√©s y facilitaci√≥n de estiramientos</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Colocar una mano en el abdomen</li>
                                    <li>Inspirar lentamente hinchando el abdomen</li>
                                    <li>Exhalar dejando que el abdomen se hunda</li>
                                    <li>Repetir 5-10 veces</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="exercise-visual">
                        <div class="exercise-animation">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <!-- Respiraci√≥n costal -->
                                <rect x="60" y="60" width="60" height="60" fill="#667eea" opacity="0.2" rx="10">
                                    <animate attributeName="width" values="60;80;60" dur="4s" repeatCount="indefinite"/>
                                    <animate attributeName="x" values="60;50;60" dur="4s" repeatCount="indefinite"/>
                                </rect>
                                <!-- Costillas -->
                                <line x1="60" y1="75" x2="40" y2="75" stroke="#ff6b6b" stroke-width="2" opacity="0.6">
                                    <animate attributeName="x2" values="40;30;40" dur="4s" repeatCount="indefinite"/>
                                </line>
                                <line x1="120" y1="75" x2="140" y2="75" stroke="#ff6b6b" stroke-width="2" opacity="0.6">
                                    <animate attributeName="x2" values="140;150;140" dur="4s" repeatCount="indefinite"/>
                                </line>
                                <text x="90" y="170" text-anchor="middle" font-size="12" fill="#333">Respiraci√≥n costal</text>
                            </svg>
                        </div>
                        <div class="exercise-description">
                            <h4>Respiraci√≥n Costal</h4>
                            <p>Expansi√≥n de la caja tor√°cica</p>
                            <div class="exercise-steps">
                                <ol>
                                    <li>Manos en las costillas laterales</li>
                                    <li>Inspirar expandiendo las costillas</li>
                                    <li>Sentir c√≥mo se separan las manos</li>
                                    <li>Exhalar juntando las costillas</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="warning-box" style="margin-top: 20px;">
                    ‚ö†Ô∏è <strong>IMPORTANTE:</strong> Todos los ejercicios deben ser supervisados por un fisioterapeuta especializado en EM. Realizar en ambiente fresco y evitar la fatiga excesiva.
                </div>
            </div>
            <!-- Secci√≥n de Evoluci√≥n -->
            <div class="content-section" id="history">
                <h2>Evoluci√≥n Temporal</h2>
                
                <div id="improvementSummary" class="success-box" style="display:none;">
                    <h3>üìà Resumen de Evoluci√≥n</h3>
                    <p id="improvementText"></p>
                </div>
               
                <div class="eval-card">
                    <h3>Hist√≥rico de Evaluaciones</h3>
                    <div style="overflow-x: auto;">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>NRS</th>
                                    <th>Ashworth</th>
                                    <th>Espasmos</th>
                                    <th>TUG (seg)</th>
                                    <th>PCI</th>
                                    <th>Bladder</th>
                                    <th>Dolor EVA</th>
                                    <th>Evoluci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <tr><td colspan="9" style="text-align: center;">No hay registros hist√≥ricos</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="eval-card" style="margin-top: 20px;">
                    <h3>Gr√°fico de Evoluci√≥n</h3>
                    <div class="chart-container">
                        <canvas id="evolutionChart" width="800" height="300"></canvas>
                    </div>
                </div>
            </div>
            <!-- Secci√≥n de Informe -->
            <div class="content-section" id="report">
                <h2>Informe Cl√≠nico</h2>
               
                <div class="report-section">
                    <h3>Resumen de Evaluaci√≥n Actual</h3>
                    <div id="reportContent">
                        <p>No hay datos de evaluaci√≥n disponibles. Complete las evaluaciones para generar el informe.</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateReport(this)">üìÑ Generar Informe Completo</button>
                <button class="print-button" onclick="window.print()">üñ®Ô∏è Imprimir/Guardar PDF</button>
            </div>
        </div>
    </div>
    <script>
        // Variables globales
        let evaluationData = {
            nrs: 5,
            ashworth: '0',
            spasmsFreq: '0',
            spasmsIntensity: '0',
            spasmsTotal: 0,
            tugTime: null,
            hrRest: null,
            hrPost: null,
            impactScore: 5,
            painScore: 5,
            pci: null,
            avdMobility: 0,
            avdTransfers: 0,
            avdToilet: 0,
            avdDressing: 0,
            avdTotal: 0,
            bladderFrequency: 0,
            bladderUrgency: 0,
            bladderIncontinence: 0,
            bladderNocturia: 0,
            bladderEmptying: 0,
            bladderProtection: 0,
            bladderTotal: 0,
            sleepQuality: 0,
            sleepDisturbance: 0,
            sleepLatency: 0,
            sleepHours: null,
            sleepTotal: 0
        };
        let historyData = [];
        
        // Funciones de inicializaci√≥n
        function acceptDisclaimer() {
            document.getElementById('disclaimer').classList.remove('active');
            document.getElementById('mainContent').classList.add('active');
        }
        
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
           
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
           
            document.getElementById(section).classList.add('active');
           
            if (event && event.target) {
                event.target.classList.add('active');
            }
           
            window.scrollTo(0, 0);
           
            if (section === 'history') {
                updateHistoryTable();
                setTimeout(drawChart, 100);
            }
            
            if (section === 'exercises') {
                updateExerciseRecommendations();
            }
        }
        
        function returnToMenu() {
            showSection('info');
            document.querySelectorAll('.nav-tab')[0].classList.add('active');
        }
        
        // Nueva funci√≥n para generar recomendaciones de ejercicios
        function getExerciseRecommendations(data) {
            let exercises = [];
            
            if (parseFloat(data.ashworth) >= 2 || data.ashworth === '1+' || parseFloat(data.ashworth) >= 1.5) {
                exercises.push('üßä <strong>Priorizar crioterapia</strong> antes de cualquier estiramiento (15-20 min de aplicaci√≥n)');
            }
            
            if (data.tugTime && parseFloat(data.tugTime) > 20) {
                exercises.push('‚öñÔ∏è <strong>Enfocarse en ejercicios de equilibrio y transferencias seguras</strong> (Ver secci√≥n de Transferencias Seguras)');
                exercises.push('üìñ <strong>Consultar p√°ginas 15-22 del PDF Almirall</strong> para t√©cnicas detalladas de transferencias');
            }
            
            if (data.bladderTotal > 10) {
                exercises.push('üèãÔ∏è <strong>Incluir ejercicios de suelo p√©lvico</strong> para mejorar control vesical');
            }
            
            if (data.painScore > 6) {
                exercises.push('üå¨Ô∏è <strong>Priorizar ejercicios respiratorios</strong> para manejo del dolor antes de estiramientos');
            }
            
            if (data.spasmsTotal > 4) {
                exercises.push('üîÑ <strong>Realizar movilizaciones pasivas lentas</strong> antes de estiramientos activos');
            }
            
            if (data.sleepTotal > 8) {
                exercises.push('üåô <strong>Ejercicios de relajaci√≥n vespertinos</strong> (respiraci√≥n y estiramientos suaves)');
            }
            
            if (data.avdTotal > 35) {
                exercises.push('üí™ <strong>Priorizar ejercicios asistidos</strong> con ayuda del cuidador (ver p√°ginas 31-33 del PDF)');
            }
            
            return exercises;
        }
        
        // Nueva funci√≥n para actualizar las recomendaciones de ejercicios
        function updateExerciseRecommendations() {
            const recommendations = getExerciseRecommendations(evaluationData);
            const recommendationsDiv = document.getElementById('exerciseRecommendations');
            const recommendationsList = document.getElementById('exerciseRecommendationsList');
            
            if (recommendations.length > 0) {
                recommendationsDiv.style.display = 'block';
                recommendationsList.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            } else {
                recommendationsDiv.style.display = 'none';
            }
        }
        
        // Funciones de actualizaci√≥n de valores
        function updateNRS() {
            const value = document.getElementById('nrsScore').value;
            document.getElementById('nrsValue').textContent = value;
            evaluationData.nrs = value;
        }
        
        function updateImpact() {
            const value = document.getElementById('impactScore').value;
            document.getElementById('impactValue').textContent = value;
            evaluationData.impactScore = value;
        }
        
        function updatePain() {
            const value = document.getElementById('painScore').value;
            document.getElementById('painValue').textContent = value;
            evaluationData.painScore = value;
        }
        
        function updateSpasmsTotal() {
            const freq = parseInt(document.getElementById('spasmsFreq').value) || 0;
            const intensity = parseInt(document.getElementById('spasmsIntensity').value) || 0;
            const total = freq + intensity;
           
            document.getElementById('spasmsTotal').textContent = total;
           
            evaluationData.spasmsFreq = freq;
            evaluationData.spasmsIntensity = intensity;
            evaluationData.spasmsTotal = total;
        }
        
        window.addEventListener('DOMContentLoaded', function() {
            const spasmsFreq = document.getElementById('spasmsFreq');
            const spasmsIntensity = document.getElementById('spasmsIntensity');
           
            if (spasmsFreq) {
                spasmsFreq.addEventListener('change', updateSpasmsTotal);
            }
            if (spasmsIntensity) {
                spasmsIntensity.addEventListener('change', updateSpasmsTotal);
            }
        });
        
        function calculateAVDScore() {
            const mobility = parseInt(document.getElementById('avdMobility').value) || 0;
            const transfers = parseInt(document.getElementById('avdTransfers').value) || 0;
            const toilet = parseInt(document.getElementById('avdToilet').value) || 0;
            const dressing = parseInt(document.getElementById('avdDressing').value) || 0;
           
            const total = mobility + transfers + toilet + dressing;
            document.getElementById('avdTotal').textContent = total;
           
            evaluationData.avdMobility = mobility;
            evaluationData.avdTransfers = transfers;
            evaluationData.avdToilet = toilet;
            evaluationData.avdDressing = dressing;
            evaluationData.avdTotal = total;
        }
        
        function calculateBladderScore() {
            const frequency = parseInt(document.getElementById('bladderFrequency').value) || 0;
            const urgency = parseInt(document.getElementById('bladderUrgency').value) || 0;
            const incontinence = parseInt(document.getElementById('bladderIncontinence').value) || 0;
            const nocturia = parseInt(document.getElementById('bladderNocturia').value) || 0;
            const emptying = parseInt(document.getElementById('bladderEmptying').value) || 0;
            const protection = parseInt(document.getElementById('bladderProtection').value) || 0;
           
            const total = frequency + urgency + incontinence + nocturia + emptying + protection;
            document.getElementById('bladderTotal').textContent = total;
           
            evaluationData.bladderFrequency = frequency;
            evaluationData.bladderUrgency = urgency;
            evaluationData.bladderIncontinence = incontinence;
            evaluationData.bladderNocturia = nocturia;
            evaluationData.bladderEmptying = emptying;
            evaluationData.bladderProtection = protection;
            evaluationData.bladderTotal = total;
        }
        
        function calculateSleepScore() {
            const quality = parseInt(document.getElementById('sleepQuality').value) || 0;
            const disturbance = parseInt(document.getElementById('sleepDisturbance').value) || 0;
            const latency = parseInt(document.getElementById('sleepLatency').value) || 0;
            const hours = parseFloat(document.getElementById('sleepHours').value) || 0;
           
            let hoursScore = 0;
            if (hours < 5) hoursScore = 3;
            else if (hours < 6) hoursScore = 2;
            else if (hours < 7) hoursScore = 1;
           
            const total = quality + disturbance + latency + hoursScore;
            document.getElementById('sleepTotal').textContent = total;
           
            evaluationData.sleepQuality = quality;
            evaluationData.sleepDisturbance = disturbance;
            evaluationData.sleepLatency = latency;
            evaluationData.sleepHours = hours;
            evaluationData.sleepTotal = total;
        }
        
        function calculatePCI() {
            const hrRest = parseFloat(document.getElementById('hrRest').value);
            const hrPost = parseFloat(document.getElementById('hrPost').value);
            const distance = parseFloat(document.getElementById('distance').value);
            const tugTime = parseFloat(document.getElementById('tugTime').value);
           
            if (!hrRest || !hrPost || !distance || !tugTime) {
                alert('Por favor, complete todos los campos necesarios');
                return;
            }
           
            const velocity = distance / tugTime;
            const pci = (hrPost - hrRest) / (velocity * 60);
           
            document.getElementById('pciResult').style.display = 'block';
            document.getElementById('pciValue').textContent = `PCI: ${pci.toFixed(2)} latidos/metro`;
           
            evaluationData.hrRest = hrRest;
            evaluationData.hrPost = hrPost;
            evaluationData.pci = pci;
        }
        
        function saveEvaluation(button) {
            evaluationData.ashworth = document.getElementById('ashworth').value;
            updateSpasmsTotal();
            evaluationData.tugTime = document.getElementById('tugTime').value;
           
            const today = new Date().toLocaleDateString('es-ES');
            const newEntry = {
                date: today,
                ...evaluationData
            };
           
            historyData.push(newEntry);
           
            button.className = 'btn btn-success';
            button.innerHTML = '‚úÖ Guardado correctamente';
           
            setTimeout(() => {
                button.className = 'btn btn-primary';
                button.innerHTML = 'üíæ Guardar Evaluaci√≥n';
            }, 2000);
        }
        
        function saveEnergyEvaluation(button) {
            const today = new Date().toLocaleDateString('es-ES');
            const existingEntry = historyData.find(entry => entry.date === today);
           
            if (existingEntry) {
                existingEntry.pci = evaluationData.pci;
                existingEntry.hrRest = evaluationData.hrRest;
                existingEntry.hrPost = evaluationData.hrPost;
            } else {
                historyData.push({
                    date: today,
                    ...evaluationData
                });
            }
           
            button.className = 'btn btn-success';
            button.innerHTML = '‚úÖ Guardado correctamente';
           
            setTimeout(() => {
                button.className = 'btn btn-success';
                button.innerHTML = 'üíæ Guardar Evaluaci√≥n';
            }, 2000);
        }
        
        function saveQualityOfLife(button) {
            calculateAVDScore();
            calculateBladderScore();
            calculateSleepScore();
           
            const today = new Date().toLocaleDateString('es-ES');
            const existingEntry = historyData.find(entry => entry.date === today);
           
            if (existingEntry) {
                Object.assign(existingEntry, evaluationData);
            } else {
                historyData.push({
                    date: today,
                    ...evaluationData
                });
            }
           
            button.className = 'btn btn-success';
            button.innerHTML = '‚úÖ Guardado correctamente';
           
            setTimeout(() => {
                button.className = 'btn btn-primary';
                button.innerHTML = 'üíæ Guardar Evaluaci√≥n';
            }, 2000);
        }
        
        function updateHistoryTable() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
           
            if (historyData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No hay registros hist√≥ricos</td></tr>';
                return;
            }
           
            // Mostrar resumen de mejoras si hay m√°s de una evaluaci√≥n
            if (historyData.length > 1) {
                const improvementSummary = document.getElementById('improvementSummary');
                const improvementText = document.getElementById('improvementText');
                const improvements = checkImprovements();
                
                if (improvements.length > 0) {
                    improvementSummary.style.display = 'block';
                    improvementText.innerHTML = improvements.join('<br>');
                }
            }
           
            historyData.forEach((entry, index) => {
                const row = tbody.insertRow();
                let evolutionIndicator = '';
                
                if (index > 0) {
                    const prevEntry = historyData[index - 1];
                    if (parseFloat(entry.nrs) < parseFloat(prevEntry.nrs)) {
                        evolutionIndicator = '<span class="improvement-indicator">‚Üì Mejora</span>';
                    } else if (parseFloat(entry.nrs) > parseFloat(prevEntry.nrs)) {
                        evolutionIndicator = '<span style="color: red;">‚Üë Empeora</span>';
                    }
                }
                
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.nrs}</td>
                    <td>${entry.ashworth}</td>
                    <td>${entry.spasmsTotal || '-'}</td>
                    <td>${entry.tugTime || '-'}</td>
                    <td>${entry.pci ? entry.pci.toFixed(2) : '-'}</td>
                    <td>${entry.bladderTotal || '-'}</td>
                    <td>${entry.painScore || '-'}</td>
                    <td>${evolutionIndicator}</td>
                `;
            });
        }
        
        function checkImprovements() {
            const improvements = [];
            
            if (historyData.length < 2) return improvements;
            
            const latest = historyData[historyData.length - 1];
            const previous = historyData[historyData.length - 2];
            
            if (parseFloat(latest.nrs) < parseFloat(previous.nrs)) {
                const reduction = ((parseFloat(previous.nrs) - parseFloat(latest.nrs)) / parseFloat(previous.nrs) * 100).toFixed(1);
                improvements.push(`‚úÖ <strong>NRS de Espasticidad:</strong> Reducci√≥n del ${reduction}% (de ${previous.nrs} a ${latest.nrs})`);
            }
            
            if (latest.tugTime && previous.tugTime && parseFloat(latest.tugTime) < parseFloat(previous.tugTime)) {
                improvements.push(`‚úÖ <strong>Test TUG:</strong> Mejora de ${parseFloat(previous.tugTime) - parseFloat(latest.tugTime)} segundos`);
            }
            
            if (parseFloat(latest.painScore) < parseFloat(previous.painScore)) {
                improvements.push(`‚úÖ <strong>Dolor:</strong> Reducci√≥n de ${previous.painScore} a ${latest.painScore}`);
            }
            
            if (latest.bladderTotal < previous.bladderTotal) {
                improvements.push(`‚úÖ <strong>S√≠ntomas vesicales:</strong> Mejora de ${previous.bladderTotal - latest.bladderTotal} puntos`);
            }
            
            if (latest.sleepTotal < previous.sleepTotal) {
                improvements.push(`‚úÖ <strong>Calidad del sue√±o:</strong> Mejora de ${previous.sleepTotal - latest.sleepTotal} puntos`);
            }
            
            return improvements;
        }
        
        function drawChart() {
            const canvas = document.getElementById('evolutionChart');
            if (!canvas) return;
           
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
           
            canvas.width = rect.width;
            canvas.height = 300;
           
            ctx.clearRect(0, 0, canvas.width, canvas.height);
           
            if (historyData.length < 2) {
                ctx.font = '14px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('Se necesitan al menos 2 evaluaciones para mostrar evoluci√≥n', canvas.width/2, 150);
                return;
            }
           
            const padding = 50;
            const graphWidth = canvas.width - (padding * 2);
            const graphHeight = canvas.height - (padding * 2);
           
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
           
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
           
            const xStep = graphWidth / (historyData.length - 1);
           
            historyData.forEach((entry, index) => {
                const x = padding + (index * xStep);
                const y = canvas.height - padding - (entry.nrs * graphHeight / 10);
               
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
               
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
               
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(entry.nrs, x, y - 10);
               
                ctx.save();
                ctx.translate(x, canvas.height - padding + 20);
                ctx.rotate(-Math.PI/4);
                ctx.textAlign = 'right';
                ctx.font = '10px Arial';
                ctx.fillText(entry.date, 0, 0);
                ctx.restore();
            });
           
            ctx.strokeStyle = '#667eea';
            ctx.stroke();
        }
        
        function getPCIMetric() {
            if (!evaluationData.pci) {
                return '<div class="report-metric metric-info"><strong>PCI:</strong> No evaluado</div>';
            }
           
            const pci = evaluationData.pci;
            let className = '';
            let interpretation = '';
           
            if (pci < 0.5) {
                className = 'metric-good';
                interpretation = 'Eficiencia energ√©tica normal';
            } else if (pci < 1.0) {
                className = 'metric-warning';
                interpretation = 'Eficiencia energ√©tica ligeramente reducida';
            } else if (pci < 1.5) {
                className = 'metric-danger';
                interpretation = 'Eficiencia energ√©tica moderadamente reducida';
            } else {
                className = 'metric-danger';
                interpretation = 'Eficiencia energ√©tica severamente reducida';
            }
           
            return `<div class="report-metric ${className}">
                <strong>PCI:</strong> ${pci.toFixed(2)} latidos/metro - ${interpretation}
            </div>`;
        }
        
        function getBladderMetric() {
            const total = evaluationData.bladderTotal;
            let className = '';
            let interpretation = '';
           
            if (total <= 5) {
                className = 'metric-good';
                interpretation = 'S√≠ntomas leves';
            } else if (total <= 10) {
                className = 'metric-warning';
                interpretation = 'S√≠ntomas moderados (considerar tratamiento)';
            } else if (total <= 15) {
                className = 'metric-danger';
                interpretation = 'S√≠ntomas severos (requiere evaluaci√≥n urol√≥gica)';
            } else {
                className = 'metric-danger';
                interpretation = 'S√≠ntomas muy severos (evaluaci√≥n urgente)';
            }
           
            return `<div class="report-metric ${className}">
                <strong>NBSS (S√≠ntomas vesicales):</strong> ${total}/20 - ${interpretation}
            </div>`;
        }
        
        function generateReport(button) {
            const reportContent = document.getElementById('reportContent');
            
            // Generar lista de mejor√≠as si existen
            let improvementsSection = '';
            if (historyData.length > 1) {
                const improvements = checkImprovements();
                if (improvements.length > 0) {
                    improvementsSection = `
                    <h4>Evoluci√≥n desde la √∫ltima evaluaci√≥n</h4>
                    <div class="report-metric metric-good">
                        ${improvements.join('<br>')}
                    </div>`;
                }
            }
           
            const reportHTML = `
                <div style="font-family: Arial, sans-serif;">
                    <h4>Fecha: ${new Date().toLocaleDateString('es-ES')}</h4>
                   
                    <h4>Evaluaci√≥n de Espasticidad</h4>
                    <div class="report-metric ${evaluationData.nrs <= 3 ? 'metric-good' : evaluationData.nrs <= 6 ? 'metric-warning' : 'metric-danger'}">
                        <strong>NRS de Espasticidad:</strong> ${evaluationData.nrs}/10
                    </div>
                    <div class="report-metric metric-info">
                        <strong>Escala de Ashworth:</strong> ${evaluationData.ashworth}
                    </div>
                    <div class="report-metric ${evaluationData.spasmsTotal <= 2 ? 'metric-good' : evaluationData.spasmsTotal <= 5 ? 'metric-warning' : 'metric-danger'}">
                        <strong>Puntuaci√≥n total de espasmos:</strong> ${evaluationData.spasmsTotal}/7
                    </div>
                    <div class="report-metric ${!evaluationData.tugTime ? 'metric-info' : evaluationData.tugTime < 10 ? 'metric-good' : evaluationData.tugTime < 20 ? 'metric-warning' : 'metric-danger'}">
                        <strong>Test TUG:</strong> ${evaluationData.tugTime ? evaluationData.tugTime + ' segundos' : 'No evaluado'}
                    </div>
                   
                    <h4>Gasto Energ√©tico</h4>
                    ${getPCIMetric()}
                   
                    <h4>Calidad de Vida</h4>
                    <div class="report-metric ${evaluationData.impactScore <= 3 ? 'metric-good' : evaluationData.impactScore <= 6 ? 'metric-warning' : 'metric-danger'}">
                        <strong>NRS Impacto percibido:</strong> ${evaluationData.impactScore}/10
                    </div>
                    <div class="report-metric ${evaluationData.avdTotal <= 15 ? 'metric-good' : evaluationData.avdTotal <= 35 ? 'metric-warning' : 'metric-danger'}">
                        <strong>√çndice de Barthel (AVD):</strong> ${evaluationData.avdTotal}/60
                    </div>
                    ${getBladderMetric()}
                    <div class="report-metric ${evaluationData.sleepTotal <= 4 ? 'metric-good' : evaluationData.sleepTotal <= 8 ? 'metric-warning' : 'metric-danger'}">
                        <strong>PSQI (Calidad del sue√±o):</strong> ${evaluationData.sleepTotal}/12
                    </div>
                    <div class="report-metric ${evaluationData.painScore <= 3 ? 'metric-good' : evaluationData.painScore <= 6 ? 'metric-warning' : 'metric-danger'}">
                        <strong>Dolor (EVA):</strong> ${evaluationData.painScore}/10
                    </div>
                   
                    ${improvementsSection}
                   
                    <h4>Evoluci√≥n</h4>
                    <div class="report-metric metric-info">
                        <strong>Total de evaluaciones registradas:</strong> ${historyData.length}
                        ${historyData.length > 1 ?
                            '<br><strong>Tendencia general:</strong> ' +
                            (historyData[historyData.length-1].nrs < historyData[0].nrs ?
                                '<span style="color: green;">‚úÖ Mejora</span>' :
                                '<span style="color: red;">‚ö†Ô∏è Empeoramiento</span>') : ''}
                    </div>
                   
                    <h4>Recomendaciones Terap√©uticas</h4>
                    <div class="report-metric metric-info">
                        <strong>Basado en las evaluaciones realizadas:</strong>
                        <ul style="margin-top: 10px;">
                            <li>Continuar con programa de ejercicios espec√≠ficos para espasticidad</li>
                            ${parseFloat(evaluationData.ashworth) >= 2 ? '<li>üßä Aplicar crioterapia local 15-20 minutos antes de los estiramientos</li>' : '<li>Aplicar crioterapia local antes de los estiramientos</li>'}
                            <li>Realizar ejercicios respiratorios 2-3 veces al d√≠a</li>
                            <li>Mantener cambios posturales frecuentes</li>
                            <li>Evitar factores desencadenantes (estr√©s, calor, infecciones)</li>
                            ${evaluationData.tugTime > 20 ? '<li style="color: orange;">‚ö†Ô∏è <strong>RIESGO DE CA√çDAS ELEVADO:</strong> Considerar entrenamiento intensivo en transferencias seguras. <strong>Ver p√°ginas 15-22 del PDF Almirall</strong> para t√©cnicas detalladas: flexionar piernas antes de girar, no tirar del brazo, girar pelvis y hombros por separado, pivotar sobre pies</li>' : ''}
                            ${evaluationData.sleepTotal > 8 ? '<li style="color: orange;">‚ö†Ô∏è <strong>CALIDAD DEL SUE√ëO AFECTADA:</strong> Considerar evaluaci√≥n del sue√±o y posible tratamiento. Implementar higiene del sue√±o: horarios regulares, evitar estimulantes despu√©s de las 18h, ambiente fresco (18-20¬∞C), ejercicios de relajaci√≥n vespertinos</li>' : ''}
                            ${evaluationData.bladderTotal > 10 ? '<li style="color: red;">‚ö†Ô∏è <strong>S√çNTOMAS VESICALES SIGNIFICATIVOS:</strong> Se recomienda evaluaci√≥n urol√≥gica especializada y considerar ejercicios de suelo p√©lvico</li>' : ''}
                            ${evaluationData.bladderTotal > 15 ? '<li style="color: red;">‚ö†Ô∏è <strong>EVALUACI√ìN UROL√ìGICA URGENTE NECESARIA</strong></li>' : ''}
                            ${evaluationData.avdTotal > 35 ? '<li style="color: orange;">‚ö†Ô∏è <strong>DEPENDENCIA SEVERA:</strong> Se recomienda formaci√≥n espec√≠fica del cuidador. <strong>Consultar p√°ginas 31-33 del PDF Almirall</strong> para t√©cnicas de movilizaci√≥n asistida</li>' : ''}
                        </ul>
                    </div>
                    
                    <h4>Ejercicios Espec√≠ficos Recomendados</h4>
                    <div class="report-metric metric-info">
                        <ul style="margin-top: 10px;">
                            ${getExerciseRecommendations(evaluationData).map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                   
                    <p style="margin-top: 20px;"><em>Informe generado por SpastiVidad EM PRO - Herramienta de apoyo cl√≠nico</em></p>
                </div>
            `;
           
            reportContent.innerHTML = reportHTML;
           
            button.className = 'btn btn-success';
            button.innerHTML = '‚úÖ Informe generado correctamente';
           
            setTimeout(() => {
                button.className = 'btn btn-primary';
                button.innerHTML = 'üìÑ Generar Informe Completo';
            }, 3000);
        }
    </script>
</body>
</html>